{% extends 'predictors/base.html' %}

{% block content %}

<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px;">
    <h1>‚öôÔ∏è Control Room</h1>
    <span style="background: var(--primary-color); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em;">Admin Area</span>
</div>

    <!-- CARD 1: AZIONI AUTOMATICHE -->
    <div class="card" style="margin-bottom: 25px;">
        <h3>ü§ñ Azioni Automatiche</h3>
        <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9em;">Esegui i task in ordine sequenziale per aggiornare il sistema.</p>
        
        <form method="post" style="display: flex; flex-direction: column; gap: 15px;">
            {% csrf_token %}
            
            <div style="display: flex; align-items: center; gap: 10px;">
                <button type="submit" name="action" value="update_fixtures" class="btn" style="width: 100%; background-color: #e67e22; text-align: left;">
                    1. Scarica Partite (API)
                </button>
            </div>

            <div style="display: flex; align-items: center; gap: 10px;">
                <button type="submit" name="action" value="calc_features" class="btn" style="width: 100%; background-color: #2980b9; text-align: left;">
                    2. Calcola Features & ELO
                </button>
            </div>

            <div style="display: flex; align-items: center; gap: 10px;">
                <button type="submit" name="action" value="train_ai" class="btn" style="width: 100%; background-color: #27ae60; text-align: left;">
                    3. Addestra IA
                </button>
            </div>

            <div style="display: flex; align-items: center; gap: 10px;">
                <button type="submit" name="action" value="predict_next" class="btn" style="width: 100%; background-color: #8e44ad; text-align: left;">
                    4. Genera Previsioni
                </button>
            </div>
        </form>
    </div>

    <!-- CARD 2: PARTITE IN ATTESA -->
    <div class="card">
        <h3>üìù Partite in Attesa di Risultato</h3>
        <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9em;">Inserisci i risultati finali per aggiornare lo storico e ricalcolare l'IA.</p>
        
        {% if pending_matches %}
            <div class="prediction-table">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Match</th>
                            <th>Azione</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for m in pending_matches %}
                        <tr>
                            <td data-label="Data" style="color: var(--text-muted); font-size: 0.9em;">{{ m.date_time|date:"d/m H:i" }}</td>
                            <td data-label="Match">
                                <strong>{{ m.home_team.short_name|default:m.home_team.name }}</strong>
                                <span style="font-size: 0.8em; color: var(--text-muted);">vs</span>
                                <strong>{{ m.away_team.short_name|default:m.away_team.name }}</strong>
                            </td>
                            <td data-label="Azione" style="text-align: right;">
                                <a href="{% url 'edit_match' m.id %}" class="btn" style="padding: 5px 10px; font-size: 0.8em; background-color: var(--text-muted);">Inserisci</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px; color: var(--success); background: #f0fff4; border-radius: 8px; border: 1px solid #c6f6d5;">
                <div style="font-size: 2em;">‚úÖ</div>
                <p>Tutto aggiornato! Nessuna partita in attesa.</p>
            </div>
        {% endif %}
    </div>

{% endblock %}
{% extends 'predictors/base.html' %}

{% block content %}

<!-- LA SCHEDINA DELL'IA -->
{% if schedina %}
<div class="card" style="background: linear-gradient(135deg, var(--primary-color) 0%, #003380 100%); color: white; border: none; margin-bottom: 30px;">
    <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 0; display: flex; justify-content: space-between; align-items: center;">
        <span>üî• La Schedina dell'IA</span>
        <span style="font-size: 0.6em; font-weight: normal; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px;">Top Picks (Low Risk)</span>
    </h3>
    
    <div class="schedina-grid">
        {% for item in schedina %}
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.1);">
            <div>
                <div style="font-size: 0.8em; opacity: 0.8; margin-bottom: 4px;">{{ item.match.date_time|date:"H:i" }}</div>
                <div style="font-weight: bold; font-size: 0.95em;">
                    {{ item.match.home_team.short_name|default:item.match.home_team.name }}
                    <span style="opacity: 0.6; font-size: 0.8em;">vs</span>
                    {{ item.match.away_team.short_name|default:item.match.away_team.name }}
                </div>
            </div>
            <div style="background: var(--accent-color); padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 1.2em; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                {{ item.tip.label }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<!-- SEZIONE 1: PARTITE FUTURE (PREVISIONI) -->
<div style="margin-bottom: 50px;">
    <h2>üöÄ Prossimi Match</h2>
    
    {% for item in upcoming_matches %}
    <a href="{% url 'match_detail' item.match.id %}" style="text-decoration: none; color: inherit; display: block;">
        <div class="card match-card">
        
        <!-- Squadre con Logo e Forma -->
        <div>
            <div style="font-size: 0.9em; color: var(--primary-color); font-weight: bold; margin-bottom: 10px;">
                {{ item.match.date_time|date:"D d M - H:i" }}
            </div>
            
            <div style="display: flex; align-items: center; gap: 10px;">
                <!-- SQUADRA CASA -->
                <div style="text-align: center; width: 100px;">
                    <a href="{% url 'team_detail' item.match.home_team.id %}" style="text-decoration: none; color: inherit; display: block;">
                    {% if item.match.home_team.logo %}
                        <img src="{{ item.match.home_team.logo.url }}" style="height: 50px; width: auto; object-fit: contain;">
                    {% else %}
                        <div style="height: 50px; width: 50px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">üè†</div>
                    {% endif %}
                    <div style="font-size: 0.9em; font-weight: bold; margin-top: 5px;">{{ item.match.home_team.short_name|default:item.match.home_team.name }}</div>
                    </a>
                    
                    <!-- PALLINI FORMA -->
                    <div class="form-container">
                        {% for res in item.home_form %}
                            <span class="form-dot form-{{ res }}" title="{{ res }}"></span>
                        {% endfor %}
                    </div>
                </div>

                <div style="font-size: 0.8em; color: var(--text-muted); padding-top: 15px;">VS</div>

                <!-- SQUADRA OSPITE -->
                <div style="text-align: center; width: 100px;">
                    <a href="{% url 'team_detail' item.match.away_team.id %}" style="text-decoration: none; color: inherit; display: block;">
                    {% if item.match.away_team.logo %}
                        <img src="{{ item.match.away_team.logo.url }}" style="height: 50px; width: auto; object-fit: contain;">
                    {% else %}
                        <div style="height: 50px; width: 50px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">‚úàÔ∏è</div>
                    {% endif %}
                    <div style="font-size: 0.9em; font-weight: bold; margin-top: 5px;">{{ item.match.away_team.short_name|default:item.match.away_team.name }}</div>
                    </a>

                    <!-- PALLINI FORMA -->
                    <div class="form-container">
                        {% for res in item.away_form %}
                            <span class="form-dot form-{{ res }}" title="{{ res }}"></span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Box Previsione Statistiche -->
        {% if item.prediction %}
        <div class="prediction-table">
            <table>
                <thead>
                    <tr>
                        <th>{{ item.match.home_team.short_name|default:"Casa" }}</th>
                        <th>STAT</th>
                        <th>{{ item.match.away_team.short_name|default:"Ospite" }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-label="Goal">{{ item.prediction.home_goals }}</td>
                        <td>GOAL</td>
                        <td data-label="Goal">{{ item.prediction.away_goals }}</td>
                    </tr>
                    <tr>
                        <td data-label="Tiri Tot">{{ item.prediction.home_total_shots }}</td>
                        <td>TIRI TOT</td>
                        <td data-label="Tiri Tot">{{ item.prediction.away_total_shots }}</td>
                    </tr>
                    <tr>
                        <td data-label="In Porta">{{ item.prediction.home_shots_on_target }}</td>
                        <td>IN PORTA</td>
                        <td data-label="In Porta">{{ item.prediction.away_shots_on_target }}</td>
                    </tr>
                    <tr>
                        <td data-label="Corner">{{ item.prediction.home_corners }}</td>
                        <td>CORNER</td>
                        <td data-label="Corner">{{ item.prediction.away_corners }}</td>
                    </tr>
                    <tr>
                        <td data-label="Falli">{{ item.prediction.home_fouls }}</td>
                        <td>FALLI</td>
                        <td data-label="Falli">{{ item.prediction.away_fouls }}</td>
                    </tr>
                    <tr>
                        <td data-label="Gialli">{{ item.prediction.home_yellow_cards }}</td>
                        <td>GIALLI</td>
                        <td data-label="Gialli">{{ item.prediction.away_yellow_cards }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 15px; opacity: 0.5;">
            <div style="font-size: 1.5em;">‚åõ</div>
            <small>In attesa...</small>
        </div>
        {% endif %}
        {% if item.opportunities %}
        <div class="opportunities-section">
            <h4>Top 3 Consigli</h4>
            <ul>
                {% for op in item.opportunities|slice:":3" %}
                <li>
                    <span>{{ op.label }} <small>({{ op.description }})</small></span>
                    <strong>Score: {{ op.score|floatformat:0 }}</strong>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
</a>
        {% empty %}    <p style="color: var(--text-muted);">Nessuna partita programmata al momento.</p>
    {% endfor %}
</div>

<!-- SEZIONE 2: ULTIMI RISULTATI -->
<div>
    <h2>üèÅ Ultimi Risultati</h2>
    
    {% for item in recent_matches %}
    <div class="card match-card">
        
        <div>
            <div>
                {{ item.match.date_time|date:"d M Y" }}
            </div>
            
            <!-- Loghi Piccoli nello storico -->
            <a href="{% url 'team_detail' item.match.home_team.id %}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
            {% if item.match.home_team.logo %}
                <img src="{{ item.match.home_team.logo.url }}" style="height: 30px;">
            {% endif %}
            <div>
                {{ item.match.home_team.short_name|default:item.match.home_team.name }}
            </div>
            </a>
            
            <span>-</span>

            <a href="{% url 'team_detail' item.match.away_team.id %}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
            <div>
                {{ item.match.away_team.short_name|default:item.match.away_team.name }}
            </div>
            {% if item.match.away_team.logo %}
                <img src="{{ item.match.away_team.logo.url }}" style="height: 30px;">
            {% endif %}
            </a>
        </div>

        <!-- Risultato Reale -->
        <div>
            {{ item.match.result.home_goals }} - {{ item.match.result.away_goals }}
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
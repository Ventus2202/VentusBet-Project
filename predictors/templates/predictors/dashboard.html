{% extends 'predictors/base.html' %}

{% block content %}

<!-- LA SCHEDINA DELL'IA -->
{% if schedina %}
<div class="card" style="background: linear-gradient(135deg, var(--primary-color) 0%, #003380 100%); color: white; border: none; margin-bottom: 30px;">
    <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 0; display: flex; justify-content: space-between; align-items: center;">
        <span>üî• La Schedina dell'IA</span>
        <span style="font-size: 0.6em; font-weight: normal; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px;">Top Picks (Low Risk)</span>
    </h3>
    
    <div class="schedina-grid">
        {% for item in schedina %}
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.1);">
            <div>
                <div style="font-size: 0.8em; opacity: 0.8; margin-bottom: 4px;">{{ item.match.date_time|date:"H:i" }}</div>
                <div style="font-weight: bold; font-size: 0.95em;">
                    {{ item.match.home_team.short_name|default:item.match.home_team.name }}
                    <span style="opacity: 0.6; font-size: 0.8em;">vs</span>
                    {{ item.match.away_team.short_name|default:item.match.away_team.name }}
                </div>
            </div>
            <div style="background: var(--accent-color); padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 1.2em; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                {{ item.tip.label }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<!-- SEZIONE 1: PARTITE FUTURE (PREVISIONI) -->
<div style="margin-bottom: 50px;">
    <h2>üöÄ Prossimi Match</h2>
    
    {% for item in upcoming_matches %}
    <div class="card match-card-link">
        <a href="{% url 'match_detail' item.match.id %}" class="match-card-anchor"></a>
        <div class="match-card-header">
            {{ item.match.date_time|date:"D d M - H:i" }}
        </div>

        <div class="match-card-content">
            <!-- SQUADRA CASA -->
            <div class="team-info">
                <a href="{% url 'team_detail' item.match.home_team.id %}" class="team-link">
                {% if item.match.home_team.logo %}
                    <img src="{{ item.match.home_team.logo.url }}" class="team-logo" alt="{{ item.match.home_team.name }} logo">
                {% else %}
                    <div class="logo-placeholder">üè†</div>
                {% endif %}
                <div class="team-name">{{ item.match.home_team.short_name|default:item.match.home_team.name }}</div>
                </a>
                <div class="form-container">
                    {% for res in item.home_form %}
                        <span class="form-dot form-{{ res }}" title="{{ res }}"></span>
                    {% endfor %}
                </div>
            </div>

            <!-- Box Previsione Statistiche -->
            {% if item.prediction %}
            <div class="prediction-box">
                
                <div class="prediction-header">
                    <div class="score-container">
                        <span class="main-score home-score">{{ item.prediction.home_goals }}</span>
                        <div class="score-label-group">
                            <span class="vs-label">PREVISIONE</span>
                        </div>
                        <span class="main-score away-score">{{ item.prediction.away_goals }}</span>
                    </div>
                </div>
            
                <div class="stats-bars-container">
                    
                    <div class="stat-unit">
                        <div class="stat-top">
                            <span class="stat-value">{{ item.prediction.home_total_shots }}</span>
                            <span class="stat-name">TIRI TOTALI</span>
                            <span class="stat-value">{{ item.prediction.away_total_shots }}</span>
                        </div>
                        <div class="progress-track">
                            <div class="bar home-bar" style="flex-grow: {{ item.prediction.home_total_shots }};"></div>
                            <div class="bar-separator"></div>
                            <div class="bar away-bar" style="flex-grow: {{ item.prediction.away_total_shots }};"></div>
                        </div>
                    </div>
            
                    <div class="stat-unit">
                        <div class="stat-top">
                            <span class="stat-value">{{ item.prediction.home_shots_on_target }}</span>
                            <span class="stat-name">IN PORTA</span>
                            <span class="stat-value">{{ item.prediction.away_shots_on_target }}</span>
                        </div>
                        <div class="progress-track">
                            <div class="bar home-bar" style="flex-grow: {{ item.prediction.home_shots_on_target }};"></div>
                            <div class="bar-separator"></div>
                            <div class="bar away-bar" style="flex-grow: {{ item.prediction.away_shots_on_target }};"></div>
                        </div>
                    </div>
            
                    <div class="stat-unit">
                        <div class="stat-top">
                            <span class="stat-value">{{ item.prediction.home_corners }}</span>
                            <span class="stat-name">CORNER</span>
                            <span class="stat-value">{{ item.prediction.away_corners }}</span>
                        </div>
                        <div class="progress-track">
                            <div class="bar home-bar" style="flex-grow: {{ item.prediction.home_corners|add:'0.1' }};"></div>
                            <div class="bar-separator"></div>
                            <div class="bar away-bar" style="flex-grow: {{ item.prediction.away_corners|add:'0.1' }};"></div>
                        </div>
                    </div>
            
                    <div class="stat-unit">
                        <div class="stat-top">
                            <span class="stat-value">{{ item.prediction.home_yellow_cards }}</span>
                            <span class="stat-name">GIALLI</span>
                            <span class="stat-value">{{ item.prediction.away_yellow_cards }}</span>
                        </div>
                        <div class="progress-track">
                            <div class="bar home-bar" style="flex-grow: {{ item.prediction.home_yellow_cards|add:'0.1' }};"></div>
                            <div class="bar-separator"></div>
                            <div class="bar away-bar" style="flex-grow: {{ item.prediction.away_yellow_cards|add:'0.1' }};"></div>
                        </div>
                    </div>
            
                </div>
            </div>
            {% else %}
            <div class="prediction-placeholder">
                <small>ANALISI IN CORSO...</small>
            </div>
            {% endif %}

            <!-- SQUADRA OSPITE -->
            <div class="team-info">
                <a href="{% url 'team_detail' item.match.away_team.id %}" class="team-link">
                {% if item.match.away_team.logo %}
                    <img src="{{ item.match.away_team.logo.url }}" class="team-logo" alt="{{ item.match.away_team.name }} logo">
                {% else %}
                    <div class="logo-placeholder">‚úàÔ∏è</div>
                {% endif %}
                <div class="team-name">{{ item.match.away_team.short_name|default:item.match.away_team.name }}</div>
                </a>
                <div class="form-container">
                    {% for res in item.away_form %}
                        <span class="form-dot form-{{ res }}" title="{{ res }}"></span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <p style="color: var(--text-muted);">Nessuna partita programmata al momento.</p>
    {% endfor %}
</div>

<!-- SEZIONE 2: ULTIMI RISULTATI -->
<div>
    <h2>üèÅ Ultimi Risultati</h2>
    
    {% for item in recent_matches %}
    <div class="card match-card">
        
        <div>
            <div>
                {{ item.match.date_time|date:"d M Y" }}
            </div>
            
            <!-- Loghi Piccoli nello storico -->
            <a href="{% url 'team_detail' item.match.home_team.id %}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
            {% if item.match.home_team.logo %}
                <img src="{{ item.match.home_team.logo.url }}" style="height: 30px;">
            {% endif %}
            <div>
                {{ item.match.home_team.short_name|default:item.match.home_team.name }}
            </div>
            </a>
            
            <span>-</span>

            <a href="{% url 'team_detail' item.match.away_team.id %}" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
            <div>
                {{ item.match.away_team.short_name|default:item.match.away_team.name }}
            </div>
            {% if item.match.away_team.logo %}
                <img src="{{ item.match.away_team.logo.url }}" style="height: 30px;">
            {% endif %}
            </a>
        </div>

        <!-- Risultato Reale -->
        <div>
            {{ item.match.result.home_goals }} - {{ item.match.result.away_goals }}
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}